<!DOCTYPE html>
<html lang="en">
  <head>
    <title>6장 랭체인(LangChain)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://fastly.jsdelivr.net/npm/mermaid@9.4.0/dist/mermaid.min.js"></script>
<script>
    mermaid.initialize({
        startOnLoad: true,
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-sv0slik/5O0JIPdLBCR2A3XDg/1U3WuDEheZfI/DI5n8Yqc3h5kjrnr46FGBNiUAJF7rE4LHKwQ/SoSLRKAxEA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdn.jsdelivr.net/npm/lucide@0.115.0/dist/umd/lucide.min.js"></script>
<script>
    // Create callout icons
    window.addEventListener("load", () => {
        document.querySelectorAll(".callout").forEach((elem) => {
            const icon = getComputedStyle(elem).getPropertyValue('--callout-icon');
            const iconName = icon && icon.trim().replace(/^lucide-/, "");

            if (iconName) {
                const calloutTitle = elem.querySelector(".callout-title");

                if (calloutTitle) {
                    const calloutIconContainer = document.createElement("div");
                    const calloutIcon = document.createElement("i");

                    calloutIconContainer.appendChild(calloutIcon);
                    calloutIcon.setAttribute("icon-name", iconName);
                    calloutIconContainer.setAttribute("class", "callout-icon");
                    calloutTitle.insertBefore(calloutIconContainer, calloutTitle.firstChild);
                }
            }
        });

        lucide.createIcons();

        // Collapse callouts
        Array.from(document.querySelectorAll(".callout.is-collapsible")).forEach((elem) => {
            elem.querySelector('.callout-title').addEventListener("click", (event) => {
                if (elem.classList.contains("is-collapsed")) {
                    elem.classList.remove("is-collapsed");
                } else {
                    elem.classList.add("is-collapsed");
                }
            });
        });
    });
</script>


<script src="https://fastly.jsdelivr.net/npm/force-graph@1.43.0/dist/force-graph.min.js"></script>

<script defer src="https://fastly.jsdelivr.net/npm/@alpinejs/persist@3.11.1/dist/cdn.min.js"></script>
<script src="https://fastly.jsdelivr.net/npm/alpinejs@3.11.1/dist/cdn.min.js" defer></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer">
<script src="https://fastly.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<link href="/styles/digital-garden-base.css" rel="stylesheet">
    <link href="/styles/obsidian-base.css" rel="stylesheet">
    <link href="/styles/c_theme.f81e1d91.css" rel="stylesheet">


<link href="/styles/custom-style.css" rel="stylesheet">
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.webmanifest">





<style></style>
    
    
  </head>
  <body class="theme-dark markdown-preview-view markdown-rendered markdown-preview-section ">
    

    
      
    
    <div x-init="isDesktop = (window.innerWidth>=1400) ? true: false;" 
            x-on:resize.window="isDesktop = (window.innerWidth>=1400) ? true : false;" 
            x-data="{isDesktop: true, showFilesMobile: false}">

        <div x-show.important="!isDesktop" style="display: none;">
            <nav class="navbar">
    <div class="navbar-inner">
        <span style="font-size: 1.5rem; margin-right: 10px;" @click="showFilesMobile=!showFilesMobile"><i  icon-name="menu"></i></span>
        
        <a href="/" style="text-decoration: none;">
            <h1 style="margin: 15px !important;">Jam Garden</h1>
        </a>
        
    </div>
    
    
        <div class="search-button align-icon" onclick="toggleSearch()">
    <span class="search-icon">
        <i icon-name="search" ></i>
    </span>
    <span class="search-text">
        <span>Search</span>
        <span style="font-size: 0.6rem; padding: 2px 2px 0 6px; text-align:center; transform: translateY(4px);" class="search-keys">
            CTRL + K
        </span>
    </span>
</div>
    
</nav>
        </div>
        
        <div x-show="showFilesMobile && !isDesktop" @click="showFilesMobile = false" style="display:none;" class="fullpage-overlay"></div>

      <nav class="filetree-sidebar"  x-show.important="isDesktop || showFilesMobile" style="display: none;">
        
         <a href="/" style="text-decoration: none;">
               <h1 style="text-align:center;">Jam Garden</h1>
         </a>
         
        
            <div style="display: flex; justify-content: center;">
                <div class="search-button align-icon" onclick="toggleSearch()">
    <span class="search-icon">
        <i icon-name="search" ></i>
    </span>
    <span class="search-text">
        <span>Search</span>
        <span style="font-size: 0.6rem; padding: 2px 2px 0 6px; text-align:center; transform: translateY(4px);" class="search-keys">
            CTRL + K
        </span>
    </span>
</div>
            </div>
        
         <div class="folder" x-data="{isOpen: true}">
    
        <div x-show="isOpen" style="display:none" class="">
            
                <div class="folder inner-folder"  x-data="{isOpen: $persist(false).as('Blogging')}" @click.stop="isOpen=!isOpen">
                    <div class="foldername-wrapper align-icon">
                    <i x-show="isOpen" style="display: none;"  icon-name="chevron-down"></i>
                    <i x-show="!isOpen"  icon-name="chevron-right"></i>
                    <span class="foldername">Blogging</span>
                    </div>
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div class="folder inner-folder"  x-data="{isOpen: $persist(false).as('Blogging/daily')}" @click.stop="isOpen=!isOpen">
                    <div class="foldername-wrapper align-icon">
                    <i x-show="isOpen" style="display: none;"  icon-name="chevron-down"></i>
                    <i x-show="!isOpen"  icon-name="chevron-right"></i>
                    <span class="foldername">daily</span>
                    </div>
                    
                        
    
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/daily/24-02-04/">[24.02.04] 일상 </a>
                </div>
            
        </div>
        
    
                    
                </div>
            
        </div>
        
    
                    
                        
    
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div class="folder inner-folder"  x-data="{isOpen: $persist(false).as('Blogging/study')}" @click.stop="isOpen=!isOpen">
                    <div class="foldername-wrapper align-icon">
                    <i x-show="isOpen" style="display: none;"  icon-name="chevron-down"></i>
                    <i x-show="!isOpen"  icon-name="chevron-right"></i>
                    <span class="foldername">study</span>
                    </div>
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div class="folder inner-folder"  x-data="{isOpen: $persist(false).as('Blogging/study/books')}" @click.stop="isOpen=!isOpen">
                    <div class="foldername-wrapper align-icon">
                    <i x-show="isOpen" style="display: none;"  icon-name="chevron-down"></i>
                    <i x-show="!isOpen"  icon-name="chevron-right"></i>
                    <span class="foldername">books</span>
                    </div>
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div class="folder inner-folder"  x-data="{isOpen: $persist(false).as('Blogging/study/books/GPT-4+ChatGPT+라마인덱스+랭체인을 활용한 인공지능 프로그래밍')}" @click.stop="isOpen=!isOpen">
                    <div class="foldername-wrapper align-icon">
                    <i x-show="isOpen" style="display: none;"  icon-name="chevron-down"></i>
                    <i x-show="!isOpen"  icon-name="chevron-right"></i>
                    <span class="foldername">GPT-4+ChatGPT+라마인덱스+랭체인을 활용한 인공지능 프로그래밍</span>
                    </div>
                    
                        
    
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/books/GPT-4+ChatGPT+라마인덱스+랭체인을 활용한 인공지능 프로그래밍/1장/">1장 GPT-4, ChatGPT, 랭체인 개요 </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink active-note"><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/books/GPT-4+ChatGPT+라마인덱스+랭체인을 활용한 인공지능 프로그래밍/2장/">6장 랭체인(LangChain) </a>
                </div>
            
        </div>
        
    
                    
                </div>
            
        </div>
        
    
                    
                        
    
    
                    
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div class="folder inner-folder"  x-data="{isOpen: $persist(false).as('Blogging/study/cs')}" @click.stop="isOpen=!isOpen">
                    <div class="foldername-wrapper align-icon">
                    <i x-show="isOpen" style="display: none;"  icon-name="chevron-down"></i>
                    <i x-show="!isOpen"  icon-name="chevron-right"></i>
                    <span class="foldername">cs</span>
                    </div>
                    
                        
    
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/cs/asynchronous (비동기)/">asynchronous (비동기) </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/cs/asynchronous/">asynchronous (비동기) </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/cs/process (프로세스)/">process (프로세스) </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/cs/process/">process (프로세스) </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/cs/synchronous (동기)/">synchronous (동기) </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/cs/thread (스레드)/">thread (스레드) </a>
                </div>
            
        </div>
        
    
                    
                </div>
            
        </div>
        
    
                    
                        
    
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div class="folder inner-folder"  x-data="{isOpen: $persist(false).as('Blogging/study/language')}" @click.stop="isOpen=!isOpen">
                    <div class="foldername-wrapper align-icon">
                    <i x-show="isOpen" style="display: none;"  icon-name="chevron-down"></i>
                    <i x-show="!isOpen"  icon-name="chevron-right"></i>
                    <span class="foldername">language</span>
                    </div>
                    
                        
    
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/language/Javascript에 대해서/">Javascript에 대해서 </a>
                </div>
            
        </div>
        
    
                    
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div class="folder inner-folder"  x-data="{isOpen: $persist(false).as('Blogging/study/web')}" @click.stop="isOpen=!isOpen">
                    <div class="foldername-wrapper align-icon">
                    <i x-show="isOpen" style="display: none;"  icon-name="chevron-down"></i>
                    <i x-show="!isOpen"  icon-name="chevron-right"></i>
                    <span class="foldername">web</span>
                    </div>
                    
                        
    
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/Cache/">Cache </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/DNS/">DNS </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/Domain/">Domain </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/HSTS/">HSTS </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/HTTP/">HTTP </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/HTTPS/">HTTPS </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/IP/">IP </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/ISP/">ISP </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/reflow/">reflow </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/repaint/">repaint </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/request/">request </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/response/">response </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/Router/">Router </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/TCP/">TCP </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/URL/">URL </a>
                </div>
            
        </div>
        
    
                    
                        
    
        <div x-show="isOpen" style="display:none" class="filelist">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/Blogging/study/web/What is done when you enter a URL in your browser/">브라우저에 URL를 넣었을 때 어찌 되는가? </a>
                </div>
            
        </div>
        
    
                    
                </div>
            
        </div>
        
    
                    
                </div>
            
        </div>
        
    
                    
                </div>
            
        </div>
        
    
    
        <div x-show="isOpen" style="display:none" class="">
            
                <div @click.stop class="notelink "><i icon-name="sticky-note" aria-hidden="true"></i><a data-note-icon="" style="text-decoration: none;" class="filename" href="/">Welcome </a>
                </div>
            
        </div>
        
    </div>
      </nav>
    </div>

    

    
      <div class="search-container" id="globalsearch" onclick="toggleSearch()">
    <div class="search-box">
        <input type="search" id="term" placeholder="Start typing...">
        <div id="search-results"></div>
        <footer class="search-box-footer">
            <div class="navigation-hint">
                <span>Enter to select</span>
            </div>

            <div class="navigation-hint align-icon">
                <i  icon-name="arrow-up" aria-hidden="true"></i>
                <i  icon-name="arrow-down" aria-hidden="true"></i>
                <span>to navigate</span>
            </div>

            <div class="navigation-hint">
                <span>ESC to close</span>
            </div>

        </footer>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', init, false);
    document.addEventListener('DOMContentLoaded', setCorrectShortcut, false);

    window.toggleSearch = function () {
        if (document.getElementById('globalsearch').classList.contains('active')) {
            document
                .getElementById('globalsearch')
                .classList
                .remove('active');
        } else {
            document
                .getElementById('globalsearch')
                .classList
                .add('active');
            document
                .getElementById('term')
                .focus();
        }
    }

    window.toggleTagSearch = function (evt) {
        console.log(evt.textContent);
        const term = evt.textContent;
        if (term) {
            window
                .document
                .getElementById('term')
                .value = term.trim();
            window.toggleSearch();
            window.search();
        }
    }

    const loadingSvg = `
    <svg width="100" height="100" viewBox="0 0 45 45" xmlns="http://www.w3.org/2000/svg" stroke="#fff">
      <g fill="none" fill-rule="evenodd" transform="translate(1 1)" stroke-width="2">
          <circle cx="22" cy="22" r="6" stroke-opacity="0">
              <animate attributeName="r"
                   begin="1.5s" dur="3s"
                   values="6;22"
                   calcMode="linear"
                   repeatCount="indefinite" />
              <animate attributeName="stroke-opacity"
                   begin="1.5s" dur="3s"
                   values="1;0" calcMode="linear"
                   repeatCount="indefinite" />
              <animate attributeName="stroke-width"
                   begin="1.5s" dur="3s"
                   values="2;0" calcMode="linear"
                   repeatCount="indefinite" />
          </circle>
          <circle cx="22" cy="22" r="6" stroke-opacity="0">
              <animate attributeName="r"
                   begin="3s" dur="3s"
                   values="6;22"
                   calcMode="linear"
                   repeatCount="indefinite" />
              <animate attributeName="stroke-opacity"
                   begin="3s" dur="3s"
                   values="1;0" calcMode="linear"
                   repeatCount="indefinite" />
              <animate attributeName="stroke-width"
                   begin="3s" dur="3s"
                   values="2;0" calcMode="linear"
                   repeatCount="indefinite" />
          </circle>
          <circle cx="22" cy="22" r="8">
              <animate attributeName="r"
                   begin="0s" dur="1.5s"
                   values="6;1;2;3;4;5;6"
                   calcMode="linear"
                   repeatCount="indefinite" />
          </circle>
      </g>
  </svg>`;

    function debounce(func, wait, immediate) {
        var timeout;
        return function () {
            var context = this,
                args = arguments;
            var later = function () {
                timeout = null;
                if (!immediate) 
                    func.apply(context, args);
                };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) 
                func.apply(context, args);
            };
    };

    function setCorrectShortcut() {
        if (navigator.platform.toUpperCase().indexOf('MAC') >= 0) {
            document
                .querySelectorAll(".search-keys")
                .forEach(x => x.innerHTML = "⌘ + K");
        }
    }

    function createIndex(posts) {
        const encoder = (str) => str
            .toLowerCase()
            .split(/([^a-z]|[^\x00-\x7F])/)
        const contentIndex = new FlexSearch.Document({
            cache: true,
            charset: "latin:extra",
            optimize: true,
            index: [
                {
                    field: "content",
                    tokenize: "reverse",
                    encode: encoder
                }, {
                    field: "title",
                    tokenize: "forward",
                    encode: encoder
                }, {
                    field: "tags",
                    tokenize: "forward",
                    encode: encoder
                }
            ]
        })
        posts.forEach((p, idx) => {
            contentIndex.add({
                id: idx, title: p.title, content: p.content, tags: p.tags //Change to removeHTML
            })
        });
        return contentIndex;
    }

    async function init() {
        //init offline search index

        const searchIndexDate = '2024-02-06T11:57:36.801Z';
        let shouldFetch = true;
        if(localStorage.getItem("searchIndex")) {
            let {date, docs}= JSON.parse(localStorage.getItem('searchIndex'));
            if(date === searchIndexDate){
                shouldFetch = false;
                let index = createIndex(docs);
                window.docs = docs
                window.index = index;
            }        
        }
        if(shouldFetch){
            let docs = await(await fetch('/searchIndex.json?v=2024-02-06T11:57:36.801Z')).json();
            let index = createIndex(docs);
            localStorage.setItem("searchIndex", JSON.stringify({date: '2024-02-06T11:57:36.801Z', docs}));
            window.docs = docs
            window.index = index;
        }

        //open searchmodal when ctrl + k is pressed, cmd + k on mac
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                toggleSearch();
            }
            if (e.key === 'Escape') {
                document
                    .getElementById('globalsearch')
                    .classList
                    .remove('active');
            }

            //navigate search results with arrow keys
            if (document.getElementById('globalsearch').classList.contains('active')) {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    let active = document.querySelector('.searchresult.active');
                    if (active) {
                        active
                            .classList
                            .remove('active');
                        if (active.nextElementSibling) {
                            active
                                .nextElementSibling
                                .classList
                                .add('active');
                        } else {
                            document
                                .querySelector('.searchresult')
                                .classList
                                .add('active');
                        }
                    } else {
                        document
                            .querySelector('.searchresult')
                            .classList
                            .add('active');
                    }

                    let currentActive = document.querySelector('.searchresult.active');
                    if (currentActive) {
                        currentActive.scrollIntoView({behavior: 'smooth', block: 'nearest', inline: 'start'});
                    }
                }
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    let active = document.querySelector('.searchresult.active');
                    if (active) {
                        active
                            .classList
                            .remove('active');
                        if (active.previousElementSibling) {
                            active
                                .previousElementSibling
                                .classList
                                .add('active');
                        } else {
                            document
                                .querySelectorAll('.searchresult')
                                .forEach((el) => {
                                    if (!el.nextElementSibling) {
                                        el
                                            .classList
                                            .add('active');
                                    }
                                });
                        }
                    } else {
                        document
                            .querySelectorAll('.searchresult')
                            .forEach((el) => {
                                if (el.nextElementSibling) {
                                    el
                                        .classList
                                        .add('active');
                                }
                            });
                    }

                    let currentActive = document.querySelector('.searchresult.active');
                    if (currentActive) {
                        currentActive.scrollIntoView({behavior: 'smooth', block: 'nearest', inline: 'start'});
                    }

                }
                if (e.key === 'Enter') {
                    e.preventDefault();
                    let active = document.querySelector('.searchresult.active');
                    if (active) {
                        window.location.href = active
                            .querySelector("a")
                            .href;
                    }
                }
            }
        });

        const debouncedSearch = debounce(search, 200, false);
        field = document.querySelector('#term');
        field.addEventListener('keydown', (e) => {
            if (e.key !== 'ArrowDown' && e.key !== 'ArrowUp') {
                debouncedSearch();
            }
        });
        resultsDiv = document.querySelector('#search-results');

        const params = new URL(location.href).searchParams;
        if (params.get('q')) {
            field.setAttribute('value', params.get('q'));
            toggleSearch();
            search();
        }
    }
    window.lastSearch = '';
    async function search() {
        let search = field
            .value
            .trim();
        if (!search) 
            return;
        if (search == lastSearch) 
            return;
        console.log(`search for ${search}`);
        window.lastSearch = search;

        resultsDiv.innerHTML = loadingSvg;
        //let searchRequest = await fetch(`/api/search?term=${encodeURIComponent(search)}`);
        //let results = await searchRequest.json();
        let results = offlineSearch(search);
        let resultsHTML = '';
        if (!results.length) {
            let resultParagraph = document.createElement("p");
            resultParagraph.innerText = `No results for "${search}"`;
            resultsDiv.innerHTML = '';
            resultsDiv.appendChild(resultParagraph);
            return;
        }
        resultsHTML += '<div style="max-width:100%;">';
        // we need to add title, url from ref
        results.forEach(r => {
            if(r.tags && r.tags.length > 0){
                resultsHTML += `<div class="searchresult">
                    <a class="search-link" href="${r.url}">${r.title}</a>
                    <div onclick="window.location='${r.url}'">
                        <div class="header-meta">
                            <div class="header-tags">
                                ${r.tags.map(tag=>'<a class="tag" href="JavaScript:Void(0);">#'+tag+'</a>').join("")}
                            </div>
                        </div>
                        ${r.content}
                    </div>
                </div>`;
            } else {
                resultsHTML += `<div class="searchresult">
                    <a class="search-link" href="${r.url}">${r.title}</a>
                    <div onclick="window.location='${r.url}'">
                        ${r.content}
                    </div>
                </div>`;
            }
        });
        resultsHTML += '</div>';
        resultsDiv.innerHTML = resultsHTML;
    }

    function truncate(str, size) {
        //first, remove HTML
        str = str.replaceAll(/<[^>]*>/g, '');
        if (str.length < size) 
            return str;
        return str.substring(0, size - 3) + '...';
    }

    function offlineSearch(searchQuery) {
        let data = window.docs;

        let isTagSearch = searchQuery[0] === "#" && searchQuery.length > 1;

        let searchResults = isTagSearch
            ? index.search(searchQuery.substring(1), [
                {
                    field: "tags"
                }
            ])
            : index.search(searchQuery, [
                {
                    field: "title",
                    limit: 5
                }, {
                    field: "content",
                    weight: 10
                }
            ]);

        const getByField = (field) => {
            const results = searchResults.filter((x) => x.field === field)
            if (results.length === 0) {
                return []
            } else {
                return [...results[0].result]
            }
        }
        const allIds = new Set([
            ...getByField("title"),
            ...getByField("content"),
            ...getByField("tags")
        ])
        const dataIds = [...allIds];
        const finalResults = dataIds.map((id) => {
            let result = data[id];
            result.content = truncate(result.content, 400);
            result.tags = result
                .tags
                .filter((x) => x != "gardenEntry" && x != "note"); //Note is automatically added by 11ty. GardenEntry is used internally to mark the home page

            return result;
        })
        return finalResults;

    }
</script>
    

    <main class="content cm-s-obsidian ">
      <header>
        
          <h1 data-note-icon="">6장 랭체인(LangChain)</h1>
        
        <div class="header-meta">
          
            <div class="header-tags">
              
                
              
            </div>
          <div class="timestamps"><div><i icon-name="calendar-plus"></i> <span class="human-date" data-date="2024-02-04T13:16:01.975+09:00"></span></div><div><i icon-name="calendar-clock"></i> <span class="human-date" data-date="2024-02-04T13:34:56.429+09:00"></span></div></div></div>
      
      
      </header>
      
      
      <h2 id="랭체인이란?" tabindex="-1">랭체인이란?</h2>
<ul>
<li>언어 모델을 기반으로 하는 애플리케이션을 개발하기 위한 프레임워크</li>
<li><strong>LangChain 라이브러리</strong>
<ul>
<li>Python 및 JavaScript 라이브러리. 수많은 구성 요소에 대한 인터페이스 및 통합, 이러한 구성 요소를 체인 및 에이전트로 결합하기 위한 기본 런타임, 체인 및 에이전트의 구성</li>
</ul>
</li>
</ul>
<h2 id="서비스 구조" tabindex="-1">서비스 구조</h2>
<ul>
<li><strong>LangChain 템플릿</strong>
<ul>
<li>다양한 작업을 위해 쉽게 배포할 수 있는 참조 아키텍처 모음</li>
</ul>
</li>
<li><strong>LangServe</strong>
<ul>
<li>LangChain 체인을 REST API로 배포하기 위한 라이브러리</li>
</ul>
</li>
<li><strong>LangSmith</strong>
<ul>
<li>LLM 프레임워크에 구축된 체인을 디버그, 테스트, 평가 및 모니터링하고 LangChain과 원활하게 통합할 수 있는 개발자 플랫폼</li>
</ul>
</li>
<li><strong>개발</strong>
<ul>
<li>LangChain/LangChain.js에 애플리케이션을 작성</li>
</ul>
</li>
<li><strong>생산화</strong>
<ul>
<li>LangSmith를 사용하여 체인을 검사, 테스트 및 모니터링</li>
</ul>
</li>
<li><strong>배포</strong>
<ul>
<li>LangServe를 사용하여 모든 체인을 API로 전환</li>
</ul>
</li>
</ul>
<h3 id="모듈" tabindex="-1">모듈</h3>
<ul>
<li>LLM
<ul>
<li>LLM 호출을 위한 공통 인터페이스</li>
</ul>
</li>
<li>프롬프트 템플릿
<ul>
<li>사용자 입력에 따른 프롬프트 생성</li>
</ul>
</li>
<li>체인
<ul>
<li>여러 LLM과 프롬프트의 입출력을 연결</li>
</ul>
</li>
<li>에이전트
<ul>
<li>사용자의 요청에 따라 어떤 기능을 어떤 순서로 실행할 것인지 결정</li>
</ul>
</li>
<li>도구
<ul>
<li>에이전트가 수행하는 특정 기능</li>
</ul>
</li>
<li>메모리
<ul>
<li>체인 및 에이전트의 메모리 보유</li>
</ul>
</li>
</ul>
<h2 id="설치" tabindex="-1">설치</h2>
<pre><code class="language-bash">pip install langchain
</code></pre>
<h3 id="llm" tabindex="-1">LLM 예제</h3>
<ul>
<li>LLM 호출을 위한 공통 인터페이스</li>
</ul>
<pre><code class="language-python">!pip install langchain
!pip install openai

import os
os.environ[&quot;OPENAI_API_KEY&quot;] = &quot;APIKEY&quot;

from langchain.llms import OpenAI
llm = OpenAI(temperature=0.9)

print(llm(&quot;컴퓨터 게임을 만드는 새로운 한국어 회사명을 하나 제안해 주세요.&quot;); //비바게임즈
</code></pre>
<h3 id="프롬프트 템플릿 예제" tabindex="-1">프롬프트 템플릿 예제</h3>
<ul>
<li>프롬프트 템플릿은 사용자 입력으로 프롬프트를 생성하기 위한 템플릿</li>
</ul>
<pre><code class="language-python">from langchain.prompts import PromptTemplate
from langchain.chains import LLMChain

prompt = PromptTemplate(
	input_variables=[&quot;product&quot;],
	template=&quot;{product}을 만드는 새로운 한국어 회사명을 하나 제안해 주세요.&quot;,
)

print(prompt.format(product=&quot;가정용 로봇&quot;))
</code></pre>
<h3 id="체인 사용법" tabindex="-1">체인 사용법</h3>
<ul>
<li>여러 개의 LLM이나 프롬프트의 입출력을 연결하기 위한 모듈</li>
</ul>
<pre><code class="language-python">from langchain.chains import LLMChain
from langchain.llm import OepnAI
from langchin.prompts import PromptTemplate

prompt = PromptTemplate(
	input_variables=[&quot;product&quot;],
	template=&quot;{product}을 만드는 새로운 한국어 회사명을 하나 제안해 주세요.&quot;,
)

chain = LLMChain(
	llm=OpenAI(temperature=0.9),
	prompt=prompt
)

# 싱글 input, output일때는 run을 쓸수 있다.
chain.run(&quot;가정용 로봇&quot;)

# 여러 input, output일때는 call을 쓴다.
chain.call({product:&quot;가정용 로봇&quot;})
</code></pre>
<h3 id="에이전트와 도구 사용법" tabindex="-1">에이전트와 도구 사용법</h3>
<ul>
<li>사용자의 요청에 따라 어떤 기능을 어떤 순서로 실행할지 결정하는 모듈</li>
<li>체인은 미리 정해져 있는 기능을 실행하는 반면, 에이전트는 사용자의 요청에 따라 수해오디는 기능</li>
<li>예시로 웹 검색과 수치 계산을 진행합니다.
<ul>
<li>SerpAPI, llm-math</li>
</ul>
</li>
</ul>
<pre><code class="language-python">!pip install google-search-results

import os
os.environ[&quot;SERPAPI_API_KEY&quot;] = &quot;SERPAPI_KEY&quot;

from langchain.agents import load_tools
from langchain.llms import OpenAI

tools = load_tools(
	tools_names=[&quot;serpapi&quot;,&quot;llm-math&quot;],
	llm-OpenAI(temperature=0)
)

from langchain.agents import initialize_agent

agent = initialize_agent(
	agent=&quot;zero-shot-react-description&quot;,
	llm=OpenAI(temperature=0),
	tools=tools,
	verbose=True
)

# llm이 질문을 판단하여 llm-math를 사용합니다.
agnet.run(&quot;123*4를 계산기로 계산하세요.&quot;) 

# llm이 질문을 판단하여 SerpAPI를 사용합니다.
agent.run(&quot;오늘 한국 서울 날시를 웹 검색으로 확인하세요.&quot;);
</code></pre>
<h3 id="메모리 사용 예제" tabindex="-1">메모리 사용 예제</h3>
<ul>
<li>체인이나 에이턴트의 과거 기억을 보관하는 모듈
<ul>
<li>이전 대화를 기억하고 그 정보를 현재 대화에 반영</li>
</ul>
</li>
</ul>
<pre><code class="language-python">from langchain.chains import ConversationChain
from langchain.llms import OpenAI

chain = ConversationChain(
	llm=OpenAI(temperature=0),
	verbose=True
)

</code></pre>
<h2 id="use-cases" tabindex="-1">Use cases</h2>
<p><a href="https://python.langchain.com/docs/use_cases" target="_blank" class="external-link">https://python.langchain.com/docs/use_cases</a></p>
<h2 id="lang-serve" tabindex="-1">LangServe</h2>
<ul>
<li>개발자가 LangChain 실행 가능 파일과 체인을 REST API로 배포하는 데 도움</li>
<li>LangChain 애플리케이션의 원클릭 배포를 위해 LangServe의 호스팅 버전을 출시할 예정</li>
</ul>
<h3 id="특징" tabindex="-1">특징</h3>
<ul>
<li>사용자의 LangChain 개체에서 자동으로 추론된 입력 및 출력 스키마는 API 호출마다 강제되며, 풍부한 오류 메시지와 함께 사용됩니다.</li>
<li>JSONSchema 및 Swagger가 포함된 API 문서 페이지 (예시 링크 삽입)</li>
<li>단일 서버에서 많은 동시 요청을 지원하는 효율적인 /invoke/, /batch/ 및 /stream/ 엔드포인트</li>
<li>체인/에이전트에서 모든 (또는 일부) 중간 단계를 스트리밍하는 /stream_log/ 엔드포인트</li>
<li>0.0.40 버전부터는 astream_events를 지원하여 stream_log의 출력을 구문 분석할 필요 없이 쉽게 스트리밍할 수 있습니다.</li>
<li>스트리밍 출력과 중간 단계를 제공하는 Playground 페이지 (/playground/)</li>
<li>LangSmith에 내장된 (옵션) 추적 기능, API 키를 추가하기만 하면 됩니다.</li>
<li>FastAPI, Pydantic, uvloop 및 asyncio와 같은 검증된 오픈 소스 Python 라이브러리를 사용하여 모두 구축되었습니다.</li>
<li>클라이언트 SDK를 사용하여 LangServe 서버를 로컬에서 실행 중인 Runnable처럼 호출하거나 HTTP API를 직접 호출할 수 있습니다.</li>
<li>LangServe Hub</li>
</ul>
<h2 id="설치-1" tabindex="-1">설치</h2>
<pre><code class="language-python">pip install &quot;langserve[all]&quot;
</code></pre>
<h3 id="예제" tabindex="-1">예제</h3>
<ul>
<li><strong>OpenAI 및 Anthropic 채팅 모델을 예약하는 LLM</strong> 최소 예입니다. 비동기를 사용하고 일괄 처리 및 스트리밍을 지원합니다.</li>
</ul>
<pre><code class="language-python"># Server
&quot;&quot;&quot;Example LangChain server exposes multiple runnables (LLMs in this case).&quot;&quot;&quot;

from fastapi import FastAPI
from langchain.chat_models import ChatAnthropic, ChatOpenAI

from langserve import add_routes

app = FastAPI(
    title=&quot;LangChain Server&quot;,
    version=&quot;1.0&quot;,
    description=&quot;Spin up a simple api server using Langchain's Runnable interfaces&quot;,
)

add_routes(
    app,
    ChatOpenAI(),
    path=&quot;/openai&quot;,
)
add_routes(
    app,
    ChatAnthropic(),
    path=&quot;/anthropic&quot;,
)

if __name__ == &quot;__main__&quot;:
    import uvicorn

    uvicorn.run(app, host=&quot;localhost&quot;, port=8000)
</code></pre>
<pre><code class="language-python"># Client
from langchain.prompts.chat import ChatPromptTemplate
from langserve import RemoteRunnable

openai_llm = RemoteRunnable(&quot;&lt;http://localhost:8000/openai/&gt;&quot;)
anthropic = RemoteRunnable(&quot;&lt;http://localhost:8000/anthropic/&gt;&quot;)

# We can use either LLM
prompt = ChatPromptTemplate.from_messages(
    [
        (
            &quot;system&quot;,
            &quot;You are a highly educated person who loves to use big words. &quot;
            + &quot;You are also concise. Never answer in more than three sentences.&quot;,
        ),
        (&quot;human&quot;, &quot;Tell me about your favorite novel&quot;),
    ]
).format_messages()

# AIMessage(content=&quot; My favorite novel is Moby Dick by Herman Melville. The intricate plot and rich symbolism make it a complex and rewarding read. Melville's masterful prose vividly evokes the perilous life of whalers on 19th century ships.&quot;, additional_kwargs={}, example=False)
anthropic.invoke(prompt)

# My favorite novel is Moby-Dick by Herman Melville. The epic tale of Captain Ahab's quest to find and destroy the great white whale is a masterwork of American literature. Melville's dense, philosophical prose and digressive storytelling style make the novel a uniquely challenging and rewarding read.
for chunk in anthropic.stream(prompt):
    print(chunk.content, end=&quot;&quot;, flush=True)

# My favorite novel is The Art of Language by Maximo Quilana. It is a philosophical treatise on the beauty and complexity of human speech. The prose is elegant yet precise.
async for chunk in anthropic.astream(prompt):
    print(chunk.content, end=&quot;&quot;, flush=True)

# As with regular runnables, async invoke, batch and async batch variants are available by default
openai_llm.invoke(prompt)
# AIMessage(content='My favorite novel is &quot;Ulysses&quot; by James Joyce. It\\'s a complex and innovative work that explores the intricacies of human consciousness and the challenges of modernity in a highly poetic and experimental manner. The prose is richly layered and rewards careful reading.', additional_kwargs={}, example=False)
await openai_llm.ainvoke(prompt)

#[AIMessage(content=&quot; My favorite novel is Moby Dick by Herman Melville. The epic tale of Captain Ahab's obsessive quest to kill the great white whale is a profound meditation on man's struggle against nature. Melville's poetic language immerses the reader in the mysticism of the high seas.&quot;, additional_kwargs={}, example=False),
# AIMessage(content=&quot; My favorite novel is Moby Dick by Herman Melville. The intricate details of whaling, though tedious at times, serve to heighten the symbolism and tension leading to the epic battle between Captain Ahab and the elusive white whale. Melville's sublime yet economical prose immerses the reader in a turbulent seascape teeming with meaning.&quot;, additional_kwargs={}, example=False)]
anthropic.batch([prompt, prompt])

# Streaming is available by default

# [AIMessage(content=' Here is a concise description of my favorite novel in three sentences:\\n\\nMy favorite novel is Moby Dick by Herman Melville. It is the epic saga of the obsessed Captain Ahab pursuing the white whale that crippled him through the seas. The novel explores deep philosophical questions through rich symbols and metaphors.', additional_kwargs={}, example=False),
# AIMessage(content=&quot; My favorite novel is Moby Dick by Herman Melville. The epic tale of Captain Ahab's obsessive quest for the great white whale is a masterpiece of American literature. Melville's writing beautifully evokes the mystery and danger of the high seas.&quot;, additional_kwargs={}, example=False)]
await anthropic.abatch([prompt, prompt])

from langchain.schema.runnable import RunnablePassthrough
comedian_chain = (
    ChatPromptTemplate.from_messages(
        [
            (
                &quot;system&quot;,
                &quot;You are a comedian that sometimes tells funny jokes and other times you just state facts that are not funny. Please either tell a joke or state fact now but only output one.&quot;,
            ),
        ]
    )
    | openai_llm
)

joke_classifier_chain = (
    ChatPromptTemplate.from_messages(
        [
            (
                &quot;system&quot;,
                &quot;Please determine if the joke is funny. Say `funny` if it's funny and `not funny` if not funny. Then repeat the first five words of the joke for reference...&quot;,
            ),
            (&quot;human&quot;, &quot;{joke}&quot;),
        ]
    )
    | anthropic
)

chain = {&quot;joke&quot;: comedian_chain} | RunnablePassthrough.assign(
    classification=joke_classifier_chain
)

# {'joke': AIMessage(content=&quot;Why don't scientists trust atoms?\\n\\nBecause they make up everything!&quot;, additional_kwargs={}, example=False),
# 'classification': AIMessage(content=&quot; not funny\\nWhy don't scientists trust atoms?&quot;, additional_kwargs={}, example=False)}
chain.invoke({})
</code></pre>
<h2 id="lang-smith" tabindex="-1">LangSmith</h2>
<ul>
<li>프로덕션급 LLM 애플리케이션을 구축하기 위한 플랫폼</li>
<li>새로운 체인, 에이전트 또는 도구 세트를 신속하게 디버깅</li>
<li>미세 조정, 몇 번의 메시지 표시 및 평가를 위한 데이터 세트 생성 및 관리</li>
<li>자신 있게 개발하려면 애플리케이션에서 회귀 테스트를 실행하세요.</li>
<li>제품 통찰력과 지속적인 개선을 위한 생산 분석 캡처</li>
</ul>
<h2 id="strong-lang-smith-lilac-llm-fine-tuning-strong" tabindex="-1"><strong>LangSmith와 Lilac으로 LLM을 fine-tuning</strong></h2>
<p><a href="https://blog.langchain.dev/fine-tune-your-llms-with-langsmith-and-lilac/" target="_blank" class="external-link">https://blog.langchain.dev/fine-tune-your-llms-with-langsmith-and-lilac/</a></p>
<h2 id="strong-open-ai-fine-tuning-strong" tabindex="-1"><strong>OpenAI Fine-Tuning</strong></h2>
<pre><code class="language-python">from langsmith import Client

client = Client()

import datetime

project_name = &quot;default&quot;
run_type = &quot;llm&quot;
end_time = datetime.datetime.now()

runs = client.list_runs(
        project_name=project_name,
        run_type=run_type,
        error=False,
)

from langchain import chains, chat_models, prompts, schema, callbacks

chain = prompts.ChatPromptTemplate.from_template(&quot;Tell a joke for:\\n{input}&quot;) | chat_models.ChatAnthropic(tags=['my-anthropic-run']) | schema.output_parser.StrOutputParser()

with callbacks.collect_runs() as cb:
    chain.invoke({&quot;input&quot;: &quot;foo&quot;})
    # Assume feedback is logged
    run = cb.traced_runs[0]
    client.create_feedback(run.id, key=&quot;user_click&quot;, score=1)

project_name = &quot;default&quot;
end_time = datetime.datetime.now()

runs = client.list_runs(
        project_name=project_name,
        execution_order=1,
        filter='and(eq(feedback_key, &quot;user_click&quot;), eq(feedback_score, 1))',
        # For continuous scores, you can filter for &gt;, &lt;, &gt;=, &lt;= with the followingg arguments: gt/lt/gte/lte(feedback_score, 0.9)
        # filter='and(eq(feedback_key, &quot;user_click&quot;), gt(feedback_score, 0.9))',
        error=False,
)

llm_runs = []
for run in runs:
    llm_run = next(client.list_runs(project_name=project_name, run_type=&quot;llm&quot;, parent_run_id=run.id))
    llm_runs.append(llm_run)

llm_runs[0].tags

# For any &quot;Chain&quot; object, you can add tags directly on the Example with LLMChain
import uuid

unique_tag = f&quot;call:{uuid.uuid4()}&quot;

chain = chains.LLMChain(
        llm=chat_models.ChatAnthropic(tags=['my-cool-llm-tag']),  # This tag will only be applied to the LLM
        prompt=prompts.ChatPromptTemplate.from_template(&quot;Tell a joke based on the following prompt:\\n\\nPrompt:{input}&quot;),
        tags=[&quot;my-tag&quot;]
)

# You can also define at call time for the call/invoke/batch methods.
# This tag will be propagated to all child calls
print(chain({&quot;input&quot;: &quot;podcasting these days&quot;}, tags=[unique_tag]))

# If you're defining using Runnables (aka langchain expression language)
runnable = (
    prompts.ChatPromptTemplate.from_template(&quot;Tell a joke based on the following prompt:\\n\\nPrompt:{input}&quot;)
    | chat_models.ChatAnthropic(tags=['my-cool-llm-tag']) # This tag will only be applied to the LLM
    | schema.StrOutputParser(tags=['some-parser-tag'])
)

# Again, you can tag at call time as well. This tag will be propagated to all child calls
print(runnable.invoke({&quot;input&quot;: &quot;podcasting these days&quot;}, {&quot;tags&quot;: [unique_tag]}))

project_name = &quot;default&quot;
end_time = datetime.datetime.now()

runs = client.list_runs(
        execution_order=1, # Only return the root trace
        filter=f'has(tags, &quot;{unique_tag}&quot;)',
)
len(list(runs))

project_name = &quot;default&quot;
run_type = &quot;llm&quot;
end_time = datetime.datetime.now()

runs = client.list_runs(
        project_name=project_name,
        run_type=run_type,
        filter='eq(name, &quot;ChatAnthropic&quot;)',
        error=False,
)

# Example chain for the following query
from langchain import prompts, chat_models

chain = (
    prompts.ChatPromptTemplate.from_template(
        &quot;Summarize the following chat log: {input}&quot;
    )
    | chat_models.ChatOpenAI()
)

chain.invoke({&quot;input&quot;: &quot;hi there, hello....&quot;})

import datetime

project_name = &quot;default&quot;
run_type = &quot;prompt&quot;
end_time = datetime.datetime.now()

runs = client.list_runs(
        project_name=project_name,
        run_type=run_type,
        end_time=end_time,
        error=False,
)

# You can then get a sibling LLM run by searching by parent_run_id and including other criteria
for prompt_run in runs:
    llm_run = next(client.list_runs(project_name=project_name, run_type=&quot;llm&quot;, parent_run_id=prompt_run.parent_run_id))
    inputs, outputs = prompt_run.inputs, llm_run.outputs

dataset = client.create_dataset(
    dataset_name = &quot;Fine-Tuning Dataset Example&quot;, 
    description=f&quot;Chat logs taken from project {project_name} for fine-tuning&quot;,
    data_type=&quot;chat&quot;,
)
for run in runs:
    if 'messages' not in run.inputs or not run.outputs:
        # Filter out non chat runs
        continue
    try:
        # Convenience method for creating a chat example
        client.create_example_from_run(
            dataset_id=dataset.id,
            run=run,
        )
        # Or if you want to select certain keys/values in inputs
        # inputs = convert_inputs(run.inputs)
        # outputs = convert_outputs(run.outputs)
        # client.create_example(
        #     dataset_id=dataset.id,
        #     inputs=inputs,
        #     outputs=outputs,
        #     run=run,
        # )
    except:
        # Duplicate inputs raise an exception
        pass

from langsmith import schemas
from langchain import load

def convert_messages(example: schemas.Example) -&gt; dict:
    messages = load.load(example.inputs)['messages']
    message_chunk = load.load(example.outputs)['generations'][0]['message']
    return {&quot;messages&quot;: messages + [message_chunk]}

messages = [
    convert_messages(example)
    for example in client.list_examples(dataset_name=&quot;Fine-Tuning Dataset Example&quot;)
]

from langchain.adapters import openai as openai_adapter

finetuning_messages = openai_adapter.convert_messages_for_finetuning(messages)

import time
import json
import io

import openai

my_file = io.BytesIO()
for group in finetuning_messages:
    if any([&quot;function_call&quot; in message for message in group]):
        continue
    my_file.write((json.dumps({&quot;messages&quot;: group}) + &quot;\\n&quot;).encode('utf-8'))

my_file.seek(0)
training_file = openai.File.create(
  file=my_file,
  purpose='fine-tune'
)

# Wait while the file is processed
status = openai.File.retrieve(training_file.id).status
start_time = time.time()
while status != &quot;processed&quot;:
    print(f&quot;Status=[{status}]... {time.time() - start_time:.2f}s&quot;, end=&quot;\\r&quot;, flush=True)
    time.sleep(5)
    status = openai.File.retrieve(training_file.id).status
print(f&quot;File {training_file.id} ready after {time.time() - start_time:.2f} seconds.&quot;)

job = openai.FineTuningJob.create(
    training_file=training_file.id,
    model=&quot;gpt-3.5-turbo&quot;,
)

# It may take 10-20+ minutes to complete training.
status = openai.FineTuningJob.retrieve(job.id).status
start_time = time.time()
while status != &quot;succeeded&quot;:
    print(f&quot;Status=[{status}]... {time.time() - start_time:.2f}s&quot;, end=&quot;\\r&quot;, flush=True)
    time.sleep(5)
    job = openai.FineTuningJob.retrieve(job.id)
    status = job.status

from langchain import chat_models, prompts

model_name = job.fine_tuned_model
# Example: ft:gpt-3.5-turbo-0613:personal::5mty86jblapsed
model = chat_models.ChatOpenAI(model=model_name)
chain.invoke({&quot;input&quot;: &quot;Who are you designed to assist?&quot;})

</code></pre>
<h2 id="lang-graph" tabindex="-1">LangGraph</h2>
<ul>
<li>구축된(그리고 함께 사용하도록 의도된) LLM을 사용하여 상태 저장 다중 행위자 애플리케이션을 구축하기 위한 라이브러리</li>
<li>주요 용도는 LLM 어플리케이션에 <strong>사이클</strong>을 추가하는 것입니다.</li>
</ul>
<p><a class="tag" onclick="toggleTagSearch(this)" data-content="#langchain">#langchain</a> <a class="tag" onclick="toggleTagSearch(this)" data-content="#랭체인">#랭체인</a> <a class="tag" onclick="toggleTagSearch(this)" data-content="#chatgpt">#chatgpt</a></p>

      
      
      <div>
        <script src="https://utteranc.es/client.js"
                repo="jaeminkim87/blog_comment"
                issue-term="pathname"
                theme="github-dark"
                crossorigin="anonymous"
                async></script>
      </div>
    </main>

    
      <aside>
      <div class="sidebar">
            <div class="sidebar-container">
                  
                  

                  
                        
                        
                              <div class="toc">
                                    <div class="toc-title-container">
                                          <div class="toc-title">
                                                On this page
                                          </div>
                                    </div>
                                    <div class="toc-container">
                                          <nav class="toc">
                <ol>
                    
                    <li><a href="#랭체인이란?">랭체인이란?</a>
            		</li>

                    <li><a href="#서비스 구조">서비스 구조</a>
            
                <ol>
                    
                    <li><a href="#모듈">모듈</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#설치">설치</a>
            
                <ol>
                    
                    <li><a href="#llm">LLM 예제</a>
            		</li>

                    <li><a href="#프롬프트 템플릿 예제">프롬프트 템플릿 예제</a>
            		</li>

                    <li><a href="#체인 사용법">체인 사용법</a>
            		</li>

                    <li><a href="#에이전트와 도구 사용법">에이전트와 도구 사용법</a>
            		</li>

                    <li><a href="#메모리 사용 예제">메모리 사용 예제</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#use-cases">Use cases</a>
            		</li>

                    <li><a href="#lang-serve">LangServe</a>
            
                <ol>
                    
                    <li><a href="#특징">특징</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#설치-1">설치</a>
            
                <ol>
                    
                    <li><a href="#예제">예제</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#lang-smith">LangSmith</a>
            		</li>

                    <li><a href="#strong-lang-smith-lilac-llm-fine-tuning-strong">LangSmith와 Lilac으로 LLM을 fine-tuning</a>
            		</li>

                    <li><a href="#strong-open-ai-fine-tuning-strong">OpenAI Fine-Tuning</a>
            		</li>

                    <li><a href="#lang-graph">LangGraph</a>
            		</li>
                </ol>
            </nav>
                                    </div>
                              </div>
                        

                  

                        
                              
                              <div class="backlinks">
                                    <div class="backlink-title" style="margin: 4px 0 !important;">Pages mentioning this page</div>
                                          <div class="backlink-list"><div class="backlink-card">
                                                            <span class="no-backlinks-message">No other pages mentions this page</span>
                                                      </div></div>
                              </div>
                        
                  
                  
            </div>
      </div>
</aside>
    

    
      
<style>
#tooltip-wrapper {
  background: var(--background-primary);
  padding: 1em;
  border-radius: 4px;
  overflow: hidden;
  position: fixed;
  width: 80%;
  max-width: 400px;
  height: auto;
  max-height: 300px;
  font-size: 0.8em;
  box-shadow: 0 5px 10px rgba(0,0,0,0.1);
  opacity: 0;
  transition: opacity 100ms;
  unicode-bidi: plaintext;
  overflow-y: scroll;
  z-index: 10;
}

#tooltip-wrapper:after {
  content: "";
  position: absolute;
  z-index: 1;
  bottom: 0;
  left: 0;
  pointer-events: none;
  width: 100%;
  unicode-bidi: plaintext;
  height: 75px;
}
</style>
<div style="opacity: 0; display: none;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  var linkHistories = {};

  function hideTooltip() {
    opacityTimeout = setTimeout(function () {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function () {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop;
    var url = event.target.getAttribute("href");
    if (url.indexOf("http") === -1 || url.indexOf(window.location.host) !== -1) {
      let contentURL = url.split('#')[0]
      if (!linkHistories[contentURL]) {
        iframe.src = contentURL
        iframe.onload = function () {
          tooltipContentHtml = ''
          tooltipContentHtml += '<div style="font-weight: bold; unicode-bidi: plaintext;">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
          tooltipContentHtml += iframe.contentWindow.document.querySelector('.content').innerHTML
          tooltipContent.innerHTML = tooltipContentHtml
          linkHistories[contentURL] = tooltipContentHtml
          tooltipWrapper.style.display = 'block';
          tooltipWrapper.scrollTop = 0;
          setTimeout(function () {
            tooltipWrapper.style.opacity = 1;
            if (url.indexOf("#") != -1) {
              let id = url.split('#')[1];
              const focus = tooltipWrapper.querySelector(`[id='${id}']`);
              focus.classList.add('referred');
              console.log(focus);
              focus.scrollIntoView({behavior: 'smooth'}, true)
            } else {
              tooltipWrapper.scroll(0, 0);
            }
          }, 1)
        }
      } else {
        tooltipContent.innerHTML = linkHistories[contentURL]
        tooltipWrapper.style.display = 'block';
        setTimeout(function () {
          tooltipWrapper.style.opacity = 1;
          if (url.indexOf("#") != -1) {
              let id = url.split('#')[1];
              const focus = tooltipWrapper.querySelector(`[id='${id}']`);
              focus.classList.add('referred');
              focus.scrollIntoView({behavior: 'smooth'}, true)
          } else {
              tooltipWrapper.scroll(0, 0);
          }
        }, 1)
      }

      function getInnerWidth(elem) {
        var style = window.getComputedStyle(elem);
        return elem.offsetWidth - parseFloat(style.paddingLeft) - parseFloat(style.paddingRight) - parseFloat(style.borderLeft) - parseFloat(style.borderRight) - parseFloat(style.marginLeft) - parseFloat(style.marginRight);
      }

      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";

      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
        tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
        tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
        tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
        tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function (_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function (_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function (event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function (event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

  window.addEventListener("load", function(event) 
  {
    document.querySelectorAll('.internal-link').forEach(setupListeners);
    document.querySelectorAll('.backlink-card a').forEach(setupListeners);
  });
</script>

    
        <script>
      if (window.location.hash) {
        document.getElementById(window.location.hash.slice(1)).classList.add('referred');
      }
      window.addEventListener('hashchange', (evt) => {
        const oldParts = evt.oldURL.split("#");
        if (oldParts[1]) {
          document.getElementById(oldParts[1]).classList.remove('referred');
        }
        const newParts = evt.newURL.split("#");
        if (newParts[1]) {
          document.getElementById(newParts[1]).classList.add('referred');
        }
      }, false);
      const url_parts = window.location.href.split("#")
      const url = url_parts[0];
      const referrence = url_parts[1];
      document.querySelectorAll(".cm-s-obsidian > *[id]").forEach(function (el) {
        el.ondblclick = function(evt) {
          const ref_url = url + '#' + evt.target.id
          navigator.clipboard.writeText(ref_url);
      }
      });

      
    </script>
    <script src=" https://fastly.jsdelivr.net/npm/luxon@3.2.1/build/global/luxon.min.js "></script>
<script defer>
    TIMESTAMP_FORMAT = "yyyy-MMM-dd, h:mm a";
    document.querySelectorAll('.human-date').forEach(function (el) {
        el.innerHTML = luxon.DateTime.fromISO(el.getAttribute('data-date') || el.innerText).toFormat(TIMESTAMP_FORMAT);
      });
</script>
    
    
    <script>
lucide.createIcons({
            attrs: {
                class: ["svg-icon"]
            }
        });
</script>
  </body>
</html>
